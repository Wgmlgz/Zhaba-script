use 'out.zh'

fn brainfuck str s: p := malloc(3000) as charP b := 0; @ i 0..strlen(s): v := *p c := s^i
  ? c == '>': ++(p as i64)
  | c == '<': --(p as i64)
  | c == '+': ++(*p)
  | c == '-': --(*p)
  | c == '.': put v
  | c == ',': >(*p)
  | c == '[': ? !v: ++b; @ ! !b: ++i; ? s^i == '[': ++b;; ? s^i == ']': --b
  | c == ']': ? ! !v: ? c == ']': ++b;; @ ! !b: --i; ?s^i=='[': --b;; ?s^i==']': ++b;; ;; --i
